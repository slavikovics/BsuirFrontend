<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            margin: 0;
            font-family: 'Montserrat', sans-serif;
            background-color: #1a1a1a;
            color: #ffffff;
        }

        .sidenav {
            height: 100vh;
            width: clamp(250px, 25vw, 250px);
            position: fixed;
            user-select: none;
            z-index: 1;
            top: 0;
            left: 0;
            background-color: #1c1c1c;
            padding-top: 20px;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.5);
            transition: transform 0.3s ease;
        }

        .sidenav.collapsed {
            transform: translateX(-100%);
        }

        #toggleButton {
            margin-top: 20px;
        }

        .sidenav a {
            padding: 15px 25px;
            text-decoration: none;
            font-size: 16px;
            color: #818181;
            display: block;
            transition: 0.3s;
        }

        .sidenav a:hover {
            color: #f1f1f1;
            background-color: #404040;
        }

        .sidenav .logo {
            text-align: center;
            padding: 20px 0;
            font-size: 24px;
            color: #818181;
            border-bottom: 1px solid #404040;
            margin-bottom: 20px;
        }

        .main-content {
            height: 100vh;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            transition: margin-left 0.3s ease;
        }

        .main-content.expanded{
            margin-left: 0px;
        }
    </style>
</head>
<body>
    <div class="sidenav" id="sidenav">
        <div class="logo">
            <img width="40%" height="40%" src="https://mniirm.by/upload/medialibrary/b31/b31b373fc87d8c57bea4ac4ebb4d4727.png" />
            <h5>Интеллектуальный ассистент по университету</h5>
        </div>
        <a href="#chat">Чат</a>
        <a href="#settings">Об ассистенте</a>
        <button class="button" id="toggleClose">
            <img  src="open.svg" alt="Expand" width="28" height="28" style="transform: rotate(180deg);"/>
        </button>
    </div>
    <div class="main-content" id="mainContent">
        <div class="chat-container" id="chat-container">
        </div>
        <div class="chat-input-container">
            <button class="button" id="toggleOpen">
                <img src="open.svg" alt="Expand" width="28" height="28"/>
            </button>
            <div contenteditable="true" type="text" id="user-input" placeholder="Введите ваше сообщение..."></div>
            <button class="button" id="send-button">
                <img src="send.svg" alt="Send" width="28" height="28"/>
            </button>
        </div>
    </div>
    <style>
        .chat-container {
            flex-grow: 1;
            max-width: 100vw;
            scroll-margin: 0;
            display: flex;
            user-select: none;
            flex-direction: column;
            position: relative;
            overflow-y: scroll;
            padding-right: 20px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 80px;
            scrollbar-color: #404040 #1a1a1a;
        }

        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background-color: #1a1a1a;
            border-radius: 4px;
        }

        #toggleOpen{
            padding: 10px 10px 5px 10px;
            margin-left: 10px;
            margin-bottom: 8px;
            margin-right: 0px;
        }

        #toggleClose{
            padding: 10px 10px 5px 10px;
            position: absolute;
            bottom: 40px;
            right: 10px;
            margin-right: 10px;
        }

        .chat-input-container {
            width: 100%;
            background-color: #121212;
            padding: 10px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
            display: flex;
            user-select: none;
            gap: 10px;
            padding: 10px 0;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1A1A1A;
        }

        ::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #777;
        }

    </style>

    <style>
        .chat-messages {
            flex-grow: 1;
            overflow-x: hidden;
            overflow-y: auto;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        #user-input {
            flex-grow: 1;
            min-width: 100px;
            padding: 12px;
            margin: 10px 5px 10px 5px;
            border: 1px solid #252323;
            background-color: #1a1a1a;
            border-radius: 15px;
            font-size: 16px;
            color: white;
            font-family: 'Montserrat', sans-serif;
        }

        .button{
            padding: 10px;
            margin-right: 10px;
            margin-top: auto;
            margin-bottom: auto;
            border-radius: 15px;
            border: 1px solid #252323;
            background-color: #1a1a1a;
            color: #ffffff;
            font-size: 16px;
            cursor: pointer;
            transform: translateY(0);
            transform: translateY(0);
            font-family: 'Montserrat', sans-serif;
        }

        #send-button{
            padding: 10px 10px 5px 10px;
            margin-right: 10px;
            margin-bottom: 8px;

        }

        .button:hover{
            border-color: #42386e;
            box-shadow: 0 0 8px rgba(66, 56, 110, 0.3);
            transition: all 0.5s ease;
            animation: glowingBorder 4s ease-in-out infinite;
        }

        .button:focus{
            outline: none;
            background-color: #42386e;
        }

        #user-input:hover {
            border-color: #42386e;
            box-shadow: 0 0 8px rgba(66, 56, 110, 0.3);
            transition: all 0.5s ease;
        }

        #user-input:empty:before {
            content: "Задайте любой вопрос...";
            color: #aaa; /* Цвет placeholder */
            pointer-events: none;
            user-select: none; /* Отключает события для псевдоэлемента */
        }

        #user-input:focus {
            outline: none;
            border-color: #42386e;
            background-color: #29263b;
            animation: glowingBorder 4s ease-in-out infinite;
            transition: all 0,5s ease;
        }

        input::placeholder {
            user-select: none; 
        }

        @keyframes glowingBorder {
            0% {
                box-shadow: 0 0 16px rgba(66, 56, 110, 0.3);
            }
            50% {
                box-shadow: 0 0 32px rgba(66, 56, 110, 0.5);
            }
            100% {
                box-shadow: 0 0 16px rgba(66, 56, 110, 0.3);
            }

        }
    </style>

</body>
</html>

<script>
    const sidenav = document.getElementById('sidenav');
    const mainContent = document.getElementById('mainContent');
    const toggleButton = document.getElementById('toggleButton');

    toggleClose.addEventListener('click', () => {
        sidenav.classList.toggle('collapsed');
        mainContent.classList.toggle('expanded');
    });

    toggleOpen.addEventListener('click', () => {
        sidenav.classList.toggle('collapsed');
        mainContent.classList.toggle('expanded');
    });
    

    function removeAnimations(chatContainer) {
        const children = chatContainer.children;
        if (!children) return;

        for (let child of children) {
            child.style.animation = 'none';
            child.style.backgroundColor = '#1e1d26';
        }
    }

    function addMessageToChat(message) {
        const chatContainer = document.getElementById('chat-container');
        removeAnimations(chatContainer)

        const messageElement = document.createElement('div');
        const defaultScrollHeight = chatContainer.scrollHeight;

        messageElement.className = 'message';
        messageElement.style.opacity = '0';
        messageElement.style.backgroundColor = '#29263b';
        messageElement.style.marginLeft = 'auto';
        messageElement.style.marginRight = '0';

        messageElement.style.maxWidth = '60%';
        messageElement.style.minWidth = '100px';
        //messageElement.style.maxHeight = '100%';

        messageElement.style.color = '#ffffff';
        messageElement.style.padding = '15px 20px';
        messageElement.style.width = 'fit-content'; // Allow width to fit content

        chatContainer.appendChild(messageElement);


        // Animate the border/container expansion
        setTimeout(() => {
            messageElement.style.transition = 'max-width 0.5s ease-out, opacity 0.3s ease-in';
            messageElement.style.opacity = '1';
            messageElement.style.animation = 'glowingBorder 4s ease-in-out infinite';
        //}, 100);

        // Animate the text appearing letter by letter
        let index = 0;
        const textInterval = setInterval(() => {
            if (index < message.length) {
                const span = document.createElement('span');
                span.textContent = message[index];
                span.style.opacity = '0';
                messageElement.appendChild(span);
                
                // Fade in each letter
                setTimeout(() => {
                    span.style.transition = 'opacity 0.1s ease-in';
                    span.style.opacity = '1';
                }, 50);
                
                index++;
            } else {
                clearInterval(textInterval);
            }
        }, 10);

                const startTime = performance.now();
                const duration = 800; // Длительность анимации
                const scrollDiff = chatContainer.scrollHeight - defaultScrollHeight;

                function scrollStep(timestamp) {
                    const elapsed = timestamp - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    chatContainer.scrollTop = chatContainer.scrollHeight + scrollDiff * progress;

                    if (progress < 1) {
                        requestAnimationFrame(scrollStep);
                    }
                }

                requestAnimationFrame(scrollStep);
        }, 100);
    }

    document.getElementById('send-button').addEventListener('click', function() {
        const userInput = document.getElementById('user-input');
        const message = userInput.innerText.trim();
        
        if (message) {
            addMessageToChat(message);
            clearInput(userInput);
        }
    });

    // Also trigger on Enter key
    document.getElementById('user-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            const message = this.innerText.trim();
            clearInput(this);

            if (message) {
                addMessageToChat(message);
            }
        }
    });

    function clearInput(userInput){
        setTimeout(() => {
            userInput.innerHTML = '';
        }, 5);
    }
</script>


<script>
    //Deletes formating of div
        document.getElementById('user-input').addEventListener('paste', function(event) {
            // Отменяем стандартное поведение вставки
            event.preventDefault();

            // Получаем текст из буфера обмена
            const text = (event.clipboardData || window.clipboardData).getData('text/plain');
            
            // Вставляем только чистый текст
            document.execCommand('insertText', false, text);
        });
</script>

<script>
    const editableDiv = document.getElementById('user-input');

    function checkPlaceholder() {
        if (editableDiv.innerText === '') {
            editableDiv.classList.add('empty');

        } else {
            editableDiv.classList.remove('empty');
        }
    }

    editableDiv.addEventListener('input', checkPlaceholder);
    editableDiv.addEventListener('blur', checkPlaceholder);
</script>

<style>
    .message {
        background-color: '#29263b';
        user-select: text;
        flex-shrink: 0;
        border-radius: 10px;
        margin: 10px 0;
        border: 1px solid #42386e;
        word-wrap: break-word; /* Позволяет переносить длинные слова */
        overflow-wrap: break-word; /* Для лучшей поддержки */
    }
</style>
